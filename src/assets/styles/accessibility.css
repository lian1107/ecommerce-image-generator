/**
 * 可访问性样式
 * WCAG 2.1 AA 合规
 */

/* ====================
   屏幕阅读器专用样式
   ==================== */

/**
 * 视觉隐藏但对屏幕阅读器可见
 * 用于 sr-only 类
 */
.sr-only,
.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/**
 * 可聚焦时显示（用于跳过链接）
 */
.sr-only-focusable:focus,
.sr-only-focusable:active {
  position: static;
  width: auto;
  height: auto;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* ====================
   焦点样式
   ==================== */

/**
 * 全局焦点指示器
 * 确保键盘用户能清楚看到焦点位置
 */
:focus {
  outline: 2px solid var(--color-focus, #3b82f6);
  outline-offset: 2px;
}

/**
 * 移除鼠标点击时的焦点轮廓
 * 但保留键盘导航时的轮廓
 */
:focus:not(:focus-visible) {
  outline: none;
}

:focus-visible {
  outline: 2px solid var(--color-focus, #3b82f6);
  outline-offset: 2px;
}

/**
 * 增强的焦点样式（用于交互元素）
 */
button:focus-visible,
a:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible,
[role="button"]:focus-visible,
[role="link"]:focus-visible,
[tabindex]:focus-visible {
  outline: 2px solid var(--color-focus, #3b82f6);
  outline-offset: 2px;
  box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
}

/**
 * 跳过链接样式
 */
.skip-link {
  position: absolute;
  top: -100px;
  left: 0;
  z-index: 10000;
  padding: 0.75rem 1.5rem;
  background: var(--color-primary, #3b82f6);
  color: white;
  text-decoration: none;
  font-weight: 600;
  border-radius: 0 0 0.5rem 0;
  transition: top 0.2s;
}

.skip-link:focus {
  top: 0;
  outline: 3px solid white;
  outline-offset: -3px;
}

/* ====================
   键盘导航支持
   ==================== */

/**
 * 键盘可操作元素的焦点样式
 */
[role="button"][tabindex="0"]:focus-visible,
[role="checkbox"][tabindex="0"]:focus-visible,
[role="radio"][tabindex="0"]:focus-visible,
[role="switch"][tabindex="0"]:focus-visible {
  outline: 2px solid var(--color-focus, #3b82f6);
  outline-offset: 2px;
}

/**
 * 选中状态指示（用于复选框、单选按钮等）
 */
[role="checkbox"][aria-checked="true"],
[role="radio"][aria-checked="true"],
[role="switch"][aria-checked="true"] {
  position: relative;
}

/* ====================
   色彩对比度优化
   ==================== */

/**
 * 确保文本对比度符合 WCAG AA 标准
 * 普通文本: 4.5:1
 * 大文本(>=18pt): 3:1
 */

/* 主要文本颜色 */
body {
  color: var(--color-text, #1f2937);
  background: var(--color-bg, #ffffff);
}

/* 次要文本颜色 */
.text-muted,
.secondary-text {
  color: var(--color-text-muted, #6b7280);
}

/* 确保链接有足够的对比度 */
a {
  color: var(--color-link, #2563eb);
  text-decoration-skip-ink: auto;
}

a:hover,
a:focus {
  color: var(--color-link-hover, #1d4ed8);
  text-decoration: underline;
}

/* 禁用元素保持可读性 */
button:disabled,
input:disabled,
select:disabled,
textarea:disabled,
[aria-disabled="true"] {
  opacity: 0.6;
  cursor: not-allowed;
  color: var(--color-text-disabled, #9ca3af);
}

/* ====================
   减少动画（prefers-reduced-motion）
   ==================== */

/**
 * 尊重用户的减少动画偏好
 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ====================
   高对比度模式支持
   ==================== */

/**
 * Windows 高对比度模式支持
 */
@media (prefers-contrast: high) {
  :focus-visible {
    outline-width: 3px;
  }

  button,
  a,
  input,
  select,
  textarea {
    border-width: 2px;
  }
}

/* ====================
   触摸目标大小
   ==================== */

/**
 * WCAG 2.1 Level AAA: 最小触摸目标 44x44px
 */
button,
a,
input[type="button"],
input[type="submit"],
input[type="reset"],
[role="button"],
[role="link"] {
  min-height: 44px;
  min-width: 44px;
}

/* 小按钮特例（次要操作） */
.btn-sm,
.button-small {
  min-height: 36px;
  min-width: 36px;
}

/* ====================
   模态框和对话框可访问性
   ==================== */

/**
 * 模态框背景（遮罩层）
 */
[role="dialog"],
[role="alertdialog"] {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000;
  background: var(--color-bg-card, #ffffff);
  border-radius: 0.5rem;
  box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
  max-width: 90vw;
  max-height: 90vh;
  overflow: auto;
}

.dialog-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
}

/**
 * 模态框标题
 */
.dialog-title {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 1rem;
  color: var(--color-text, #1f2937);
}

/* ====================
   表单可访问性
   ==================== */

/**
 * 必填字段指示
 */
.required::after,
[aria-required="true"] label::after {
  content: " *";
  color: var(--color-danger, #ef4444);
  font-weight: bold;
}

/**
 * 错误消息样式
 */
.error-message,
[role="alert"] {
  color: var(--color-danger, #ef4444);
  font-size: 0.875rem;
  margin-top: 0.25rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.error-message::before {
  content: "⚠";
  font-size: 1rem;
}

/**
 * 输入框错误状态
 */
input:invalid:not(:focus),
select:invalid:not(:focus),
textarea:invalid:not(:focus),
[aria-invalid="true"] {
  border-color: var(--color-danger, #ef4444);
}

/* ====================
   Live Region（实时更新区域）
   ==================== */

/**
 * 用于屏幕阅读器的实时通知区域
 */
#a11y-live-region {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ====================
   加载和进度指示器
   ==================== */

/**
 * 进度条可访问性
 */
[role="progressbar"] {
  position: relative;
  overflow: hidden;
  background: var(--color-bg-secondary, #f3f4f6);
  border-radius: 0.25rem;
  height: 0.5rem;
}

[role="progressbar"]::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  background: var(--color-primary, #3b82f6);
  width: var(--progress-value, 0%);
  transition: width 0.3s ease;
}

/**
 * 加载指示器
 */
[role="status"][aria-busy="true"] {
  position: relative;
  pointer-events: none;
}

.loading-spinner {
  display: inline-block;
  width: 1em;
  height: 1em;
  border: 2px solid currentColor;
  border-right-color: transparent;
  border-radius: 50%;
  animation: spin 0.75s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* ====================
   工具提示和帮助文本
   ==================== */

/**
 * 工具提示可访问性
 */
[role="tooltip"] {
  position: absolute;
  z-index: 1000;
  padding: 0.5rem 0.75rem;
  background: var(--color-text, #1f2937);
  color: white;
  font-size: 0.875rem;
  border-radius: 0.25rem;
  max-width: 300px;
  word-wrap: break-word;
}

/* ====================
   导航和菜单
   ==================== */

/**
 * 菜单可访问性
 */
[role="menu"],
[role="menubar"] {
  list-style: none;
  padding: 0;
  margin: 0;
}

[role="menuitem"] {
  cursor: pointer;
  padding: 0.5rem 1rem;
}

[role="menuitem"]:focus,
[role="menuitem"][aria-current="true"] {
  background: var(--color-bg-hover, #f3f4f6);
}

/* ====================
   标签页（Tabs）
   ==================== */

/**
 * 标签页可访问性
 */
[role="tablist"] {
  display: flex;
  gap: 0.25rem;
  border-bottom: 2px solid var(--color-border, #e5e7eb);
}

[role="tab"] {
  padding: 0.75rem 1rem;
  cursor: pointer;
  border: none;
  background: transparent;
  color: var(--color-text-muted, #6b7280);
  font-weight: 500;
  transition: all 0.2s;
}

[role="tab"]:hover {
  color: var(--color-text, #1f2937);
}

[role="tab"][aria-selected="true"] {
  color: var(--color-primary, #3b82f6);
  border-bottom: 2px solid var(--color-primary, #3b82f6);
  margin-bottom: -2px;
}

[role="tabpanel"] {
  padding: 1rem;
}

[role="tabpanel"]:focus {
  outline: none;
}

/* ====================
   打印样式
   ==================== */

@media print {
  /* 隐藏非打印内容 */
  .no-print,
  nav,
  .skip-link {
    display: none !important;
  }

  /* 确保链接 URL 可见 */
  a[href]::after {
    content: " (" attr(href) ")";
    font-size: 0.875em;
    color: var(--color-text-muted, #6b7280);
  }

  /* 避免在元素内部分页 */
  h1, h2, h3, h4, h5, h6,
  img, table, figure {
    page-break-inside: avoid;
  }
}

/* ====================
   自定义属性（CSS Variables）
   ==================== */

/**
 * 可访问性相关的 CSS 变量
 * 可以在深色模式等场景下覆盖
 */
:root {
  --color-focus: #3b82f6;
  --focus-ring-width: 2px;
  --focus-ring-offset: 2px;
  --min-touch-target: 44px;
}
